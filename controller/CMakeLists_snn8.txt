add_executable(controller_snn
    controller_main.c
    w5500_eth.c
    z1_http_api.c
    ../common/core_queue/core_queue.c
)

# Set board to Pico 2 (RP2350)
pico_set_binary_type(controller_snn copy_to_ram)
set_target_properties(controller_snn PROPERTIES PICO_BOARD pico2)

# Increase stack size for bus operations with large buffers (default 2KB â†’ 4KB)
# Note: Dual-core = 2 stacks, so 4KB each = 8KB total
target_compile_definitions(controller_snn PRIVATE
    PICO_STACK_SIZE=0x1000  # 4KB stack per core
)

target_link_libraries(controller_snn
    pico_stdlib
    pico_multicore
    hardware_pio
    hardware_dma
    hardware_gpio
    hardware_spi
    hardware_vreg
    z1_onyx_bus
    z1_broker
    psram
    oled
    sd_card_stub
)

# Enable USB output
pico_enable_stdio_usb(controller_snn 1)
pico_enable_stdio_uart(controller_snn 0)

# PIO headers manually pre-generated and copied to build directory
# This avoids the pioasm external project build issue

# Create UF2/BIN/HEX outputs (commented out to avoid picotool dependency)
# pico_add_extra_outputs(controller_snn)
